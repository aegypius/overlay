box: wercker-labs/docker
build:
  steps:
    - script:
        name: Restore cached image to docker
        code: |-
          mkdir "$WERCKER_CACHE_DIR/docker-images/"
          if test -f "$WERCKER_CACHE_DIR/docker-images/overlay-env.tgz"; then docker load < "$WERCKER_CACHE_DIR/docker-images/overlay-env.tgz"; fi

    - script:
        name: Pull latest overlay-env
        code: |-
          docker pull aegypius/overlay-env:latest

    - script:
        name: Checking using repoman
        code: |-
          docker run -v $(pwd):/overlay -i -t aegypius/overlay-env:latest repoman ci --pretend --verbose

  after-steps:
    - script:
        name: Store docker image to cache
        code: |-
          docker save aegypius/overlay-env > $WERCKER_CACHE_DIR/docker-images/overlay-env.tgz
